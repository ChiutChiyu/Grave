<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <title>TikTok Clone with Login in Profile Menu</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: "Inter", sans-serif;
    }
    /* Scrollbar for chat and comments */
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background-color: rgba(156, 163, 175, 0.5);
      border-radius: 3px;
    }
    .scrollbar-thin {
      scrollbar-width: thin;
      scrollbar-color: rgba(156, 163, 175, 0.5) transparent;
    }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged,
      updateProfile,
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    import {
      getStorage,
      ref as storageRef,
      uploadBytes,
      getDownloadURL,
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-storage.js";
    import {
      getDatabase,
      ref as dbRef,
      set,
      get,
      child,
      onValue,
      push,
      update,
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAgOPD5DDtjExQaVeu6VLFI7CMP9i8VOQw",
      authDomain: "projectchat01-d16bc.firebaseapp.com",
      databaseURL:
        "https://projectchat01-d16bc-default-rtdb.firebaseio.com",
      projectId: "projectchat01-d16bc",
      storageBucket: "projectchat01-d16bc.appspot.com",
      messagingSenderId: "163313653543",
      appId: "1:163313653543:web:5a4c8b70d6dedb8011bb02",
      measurementId: "G-M8JFL7S0TV",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const storage = getStorage(app);
    const database = getDatabase(app);

    // Elements
    const loginForm = document.getElementById("login-form");
    const registerForm = document.getElementById("register-form");
    const profileForm = document.getElementById("profile-form");
    const logoutBtn = document.getElementById("logout-btn");
    const navFeed = document.getElementById("nav-feed");
    const navPrivateChat = document.getElementById("nav-private-chat");
    const navLeaderboard = document.getElementById("nav-leaderboard");
    const pages = document.querySelectorAll(".page");
    const userNameDisplay = document.getElementById("user-name-display");
    const userPhotoDisplay = document.getElementById("user-photo-display");
    const feedContainer = document.getElementById("feed-container");
    const leaderboardContainer = document.getElementById("leaderboard-container");
    const uploadVideoForm = document.getElementById("upload-video-form");
    const uploadVideoInput = document.getElementById("upload-video-input");
    const uploadVideoPreview = document.getElementById("upload-video-preview");
    const uploadVideoTitle = document.getElementById("upload-video-title");
    const uploadVideoDesc = document.getElementById("upload-video-desc");

    // Photo upload elements
    const uploadPhotoForm = document.getElementById("upload-photo-form");
    const uploadPhotoInput = document.getElementById("upload-photo-input");
    const uploadPhotoPreview = document.getElementById("upload-photo-preview");
    const uploadPhotoTitle = document.getElementById("upload-photo-title");
    const uploadPhotoDesc = document.getElementById("upload-photo-desc");

    // Chat and comments elements
    const commentsList = document.getElementById("comments-list");
    const commentForm = document.getElementById("comment-form");
    const commentInput = document.getElementById("comment-input");
    const commentVideoTitle = document.getElementById("comment-video-title");
    const commentVideoIdInput = document.getElementById("comment-video-id");
    const commentVideoOwnerIdInput = document.getElementById("comment-video-owner-id");

    // Private chat elements
    const privateChatSection = document.getElementById("private-chat-section");
    const privateChatList = document.getElementById("private-chat-list");
    const privateChatForm = document.getElementById("private-chat-form");
    const privateChatInput = document.getElementById("private-chat-input");
    const privateChatUserSelect = document.getElementById("private-chat-user-select");
    const privateChatMessages = document.getElementById("private-chat-messages");
    const privateChatTitle = document.getElementById("private-chat-title");
    const privateChatBackBtn = document.getElementById("private-chat-back-btn");

    // Profile menu login/register container
    const profileLoginRegisterContainer = document.getElementById("profile-login-register-container");
    const profileContentContainer = document.getElementById("profile-content-container");

    // Android-like bottom navigation GUI
    document.addEventListener("DOMContentLoaded", () => {
      const bottomNavButtons = document.querySelectorAll("#bottom-nav button");
      bottomNavButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const target = btn.getAttribute("data-target");
          showPage(target);
        });
      });
    });

    // Navigation function
    function showPage(pageId) {
      pages.forEach((page) => {
        if (page.id === pageId) {
          page.classList.remove("hidden");
        } else {
          page.classList.add("hidden");
        }
      });
      if (pageId === "feed-page") {
        loadFeed();
      }
      if (pageId === "leaderboard-page") {
        loadLeaderboard();
      }
      if (pageId === "private-chat-page") {
        loadUsersForPrivateChat();
        privateChatSection.classList.add("hidden");
        privateChatList.classList.remove("hidden");
        privateChatMessages.innerHTML = "";
        privateChatTitle.textContent = "Private Chats";
        privateChatBackBtn.style.display = "none";
      }
      if (pageId !== "video-comments-page") {
        clearComments();
      }
      if (pageId === "profile-page") {
        updateProfilePageUI();
      }
    }

    // Update profile page UI based on auth state
    function updateProfilePageUI() {
      const user = auth.currentUser;
      if (user) {
        profileLoginRegisterContainer.classList.add("hidden");
        profileContentContainer.classList.remove("hidden");
        userNameDisplay.textContent = user.displayName || user.email;
        if (user.photoURL) {
          userPhotoDisplay.src = user.photoURL;
          userPhotoDisplay.alt = `Profile photo of ${user.displayName || user.email}`;
        } else {
          userPhotoDisplay.src = "https://placehold.co/100x100/png?text=No+Photo";
          userPhotoDisplay.alt = "Default profile photo placeholder";
        }
      } else {
        profileLoginRegisterContainer.classList.remove("hidden");
        profileContentContainer.classList.add("hidden");
        userNameDisplay.textContent = "";
        userPhotoDisplay.src = "https://placehold.co/100x100/png?text=No+Photo";
        userPhotoDisplay.alt = "Default profile photo placeholder";
      }
    }

    // Initial page: show login or feed depending on auth state
    onAuthStateChanged(auth, (user) => {
      if (user) {
        navFeed.style.display = "inline-block";
        navPrivateChat.style.display = "inline-block";
        navLeaderboard.style.display = "inline-block";
        logoutBtn.style.display = "inline-block";
        showPage("feed-page");
        loadFeed();
      } else {
        navFeed.style.display = "none";
        navPrivateChat.style.display = "none";
        navLeaderboard.style.display = "none";
        logoutBtn.style.display = "none";
        showPage("login-page");
      }
    });

    // Register
    registerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = registerForm.email.value.trim();
      const password = registerForm.password.value;
      const username = registerForm.username.value.trim();

      if (!email || !password || !username) {
        alert("Please fill all fields");
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(
          auth,
          email,
          password
        );
        const user = userCredential.user;
        await updateProfile(user, { displayName: username });
        await set(dbRef(database, "users/" + user.uid), {
          username: username,
          email: email,
          photoURL: "",
        });
        alert("Registration successful!");
        registerForm.reset();
        updateProfilePageUI();
        showPage("profile-page");
      } catch (error) {
        alert(error.message);
      }
    });

    // Login
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = loginForm.email.value.trim();
      const password = loginForm.password.value;

      if (!email || !password) {
        alert("Please fill all fields");
        return;
      }

      try {
        await signInWithEmailAndPassword(auth, email, password);
        loginForm.reset();
        updateProfilePageUI();
        showPage("profile-page");
      } catch (error) {
        alert(error.message);
      }
    });

    // Logout
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      updateProfilePageUI();
      showPage("profile-page");
    });

    // Profile update
    profileForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user) {
        alert("No user logged in");
        return;
      }
      const newUsername = profileForm.username.value.trim();
      const photoFile = profileForm.photo.files[0];

      if (!newUsername) {
        alert("Username cannot be empty");
        return;
      }

      try {
        let photoURL = user.photoURL || "";
        if (photoFile) {
          const photoStorageRef = storageRef(
            storage,
            "profilePhotos/" + user.uid + "/" + photoFile.name
          );
          await uploadBytes(photoStorageRef, photoFile);
          photoURL = await getDownloadURL(photoStorageRef);
        }
        await updateProfile(user, {
          displayName: newUsername,
          photoURL: photoURL,
        });
        await set(dbRef(database, "users/" + user.uid), {
          username: newUsername,
          email: user.email,
          photoURL: photoURL,
        });
        alert("Profile updated!");
        userNameDisplay.textContent = newUsername;
        if (photoURL) {
          userPhotoDisplay.src = photoURL;
          userPhotoDisplay.alt = `Profile photo of ${newUsername}`;
        }
        profileForm.reset();
      } catch (error) {
        alert(error.message);
      }
    });

    // The rest of the app code (upload video/photo, feed, comments, private chat, leaderboard) remains the same as previous code...
    // For brevity, omitted here but should be included in full implementation.

  </script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
  <header class="bg-white shadow-md sticky top-0 z-10">
    <nav
      class="max-w-4xl mx-auto flex items-center justify-between p-4"
      role="navigation"
      aria-label="Main navigation"
    >
      <div class="text-2xl font-bold text-red-600 flex items-center space-x-2">
        <i class="fab fa-tiktok"></i>
        <span>TikTok Clone</span>
      </div>
      <ul class="hidden md:flex space-x-6 text-gray-700 font-semibold">
        <li>
          <button class="hover:text-red-600" id="nav-feed">Feed</button>
        </li>
        <li>
          <button class="hover:text-red-600" id="nav-private-chat" style="display:none;">Private Chat</button>
        </li>
        <li>
          <button class="hover:text-red-600" id="nav-leaderboard" style="display:none;">Leaderboard</button>
        </li>
      </ul>
      <button
        class="hidden bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700"
        id="logout-btn"
      >
        Logout
      </button>
    </nav>
  </header>
  <main class="flex-grow max-w-4xl mx-auto w-full p-4">
    <!-- Profile Page -->
    <section class="page hidden" id="profile-page" aria-label="Profile page">
      <h2 class="text-3xl font-semibold mb-6 text-center text-gray-800">Profile</h2>

      <!-- Login/Register container shown if not logged in -->
      <div id="profile-login-register-container" class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-md space-y-6">
        <h3 class="text-xl font-semibold text-center">Please Login or Register</h3>
        <form class="space-y-4" id="login-form">
          <div>
            <label class="block mb-1 font-medium text-gray-700" for="email">Email</label>
            <input
              class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"
              id="email"
              name="email"
              placeholder="you@example.com"
              required=""
              type="email"
            />
          </div>
          <div>
            <label class="block mb-1 font-medium text-gray-700" for="password">Password</label>
            <input
              class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"
              id="password"
              name="password"
              placeholder="Your password"
              required=""
              type="password"
            />
          </div>
          <button
            class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition"
            type="submit"
          >
            Login
          </button>
        </form>
        <p class="text-center text-gray-600">
          Don't have an account?
          <button
            class="text-red-600 font-semibold hover:underline"
            id="show-register-btn"
            type="button"
          >
            Register here
          </button>
        </p>
        <form class="space-y-4 hidden" id="register-form">
          <div>
            <label class="block mb-1 font-medium text-gray-700" for="username">Username</label>
            <input
              class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"
              id="username"
              name="username"
              placeholder="Your username"
              required=""
              type="text"
            />
          </div>
          <div>
            <label class="block mb-1 font-medium text-gray-700" for="email">Email</label>
            <input
              class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"
              id="email"
              name="email"
              placeholder="you@example.com"
              required=""
              type="email"
            />
          </div>
          <div>
            <label class="block mb-1 font-medium text-gray-700" for="password">Password</label>
            <input
              class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"
              id="password"
              name="password"
              placeholder="Your password"
              required=""
              type="password"
            />
          </div>
          <button
            class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition"
            type="submit"
          >
            Register
          </button>
          <p class="text-center text-gray-600">
            Already have an account?
            <button
              class="text-red-600 font-semibold hover:underline"
              id="show-login-btn"
              type="button"
            >
              Login here
            </button>
          </p>
        </form>
      </div>

      <!-- Profile content container shown if logged in -->
      <div id="profile-content-container" class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-md space-y-6 hidden">
        <div class="flex flex-col items-center space-y-4">
          <img
            alt="Default profile photo placeholder"
            class="w-24 h-24 rounded-full object-cover border-2 border-red-600"
            height="100"
            id="user-photo-display"
            src="https://placehold.co/100x100/png?text=No+Photo"
            width="100"
          />
          <h3 class="text-xl font-semibold text-gray-800" id="user-name-display"></h3>
        </div>
        <form class="space-y-4" id="profile-form">
          <div>
            <label class="block mb-1 font-medium text-gray-700" for="username">Change Username</label>
            <input
              class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"
              id="username"
              name="username"
              placeholder="New username"
              required=""
              type="text"
            />
          </div>
          <div>
            <label class="block mb-1 font-medium text-gray-700" for="photo">Change Profile Photo</label>
            <input accept="image/*" class="w-full" id="photo" name="photo" type="file" />
          </div>
          <button
            class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition"
            type="submit"
          >
            Update Profile
          </button>
        </form>
        <div class="max-w-md mx-auto mt-8 bg-white p-6 rounded-lg shadow-md space-y-8">
          <h3 class="text-2xl font-semibold mb-4 text-gray-800">Upload Video</h3>
          <form class="space-y-4" id="upload-video-form">
            <div>
              <label class="block mb-1 font-medium text-gray-700" for="upload-video-input">Select Video</label>
              <input
                accept="video/*"
                class="w-full"
                id="upload-video-input"
                name="upload-video-input"
                required=""
                type="file"
              />
            </div>
            <video
              class="w-full max-h-64 bg-black mb-4 hidden"
              controls=""
              id="upload-video-preview"
            ></video>
            <div>
              <label class="block mb-1 font-medium text-gray-700" for="upload-video-title">Title</label>
              <input
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"
                id="upload-video-title"
                name="upload-video-title"
                placeholder="Video title"
                required=""
                type="text"
              />
            </div>
            <div>
              <label class="block mb-1 font-medium text-gray-700" for="upload-video-desc">Description</label>
              <textarea
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"
                id="upload-video-desc"
                name="upload-video-desc"
                placeholder="Video description (optional)"
                rows="3"
              ></textarea>
            </div>
            <button
              class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition"
              id="upload-video-btn"
              type="submit"
            >
              Upload Video
            </button>
          </form>
          <h3 class="text-2xl font-semibold mb-4 text-gray-800">Upload Photo</h3>
          <form class="space-y-4" id="upload-photo-form">
            <div>
              <label class="block mb-1 font-medium text-gray-700" for="upload-photo-input">Select Photo</label>
              <input
                accept="image/*"
                class="w-full"
                id="upload-photo-input"
                name="upload-photo-input"
                required=""
                type="file"
              />
            </div>
            <img
              alt="Photo preview"
              class="w-full max-h-64 object-contain mb-4 hidden"
              id="upload-photo-preview"
            />
            <div>
              <label class="block mb-1 font-medium text-gray-700" for="upload-photo-title">Title</label>
              <input
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"
                id="upload-photo-title"
                name="upload-photo-title"
                placeholder="Photo title"
                required=""
                type="text"
              />
            </div>
            <div>
              <label class="block mb-1 font-medium text-gray-700" for="upload-photo-desc">Description</label>
              <textarea
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"
                id="upload-photo-desc"
                name="upload-photo-desc"
                placeholder="Photo description (optional)"
                rows="3"
              ></textarea>
            </div>
            <button
              class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition"
              id="upload-photo-btn"
              type="submit"
            >
              Upload Photo
            </button>
          </form>
          <button
            id="logout-profile-btn"
            class="w-full bg-gray-700 text-white py-2 rounded hover:bg-gray-900 mt-6"
            type="button"
          >
            Logout
          </button>
        </div>
      </div>
    </section>

    <!-- Other pages (feed, comments, private chat, leaderboard) remain unchanged -->

  </main>
  <!-- Android-like bottom navigation -->
  <nav
    class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 flex justify-around items-center h-16 md:hidden z-20"
    id="bottom-nav"
  >
    <button
      aria-label="Feed"
      class="flex flex-col items-center justify-center text-gray-600 hover:text-red-600 focus:outline-none"
      data-target="feed-page"
    >
      <i class="fas fa-home fa-lg"></i>
      <span class="text-xs mt-1">Feed</span>
    </button>
    <button
      aria-label="Profile"
      class="flex flex-col items-center justify-center text-gray-600 hover:text-red-600 focus:outline-none"
      data-target="profile-page"
    >
      <i class="fas fa-user fa-lg"></i>
      <span class="text-xs mt-1">Profile</span>
    </button>
    <button
      aria-label="Private Chat"
      class="flex flex-col items-center justify-center text-gray-600 hover:text-red-600 focus:outline-none"
      data-target="private-chat-page"
    >
      <i class="fas fa-comments fa-lg"></i>
      <span class="text-xs mt-1">Chat</span>
    </button>
    <button
      aria-label="Leaderboard"
      class="flex flex-col items-center justify-center text-gray-600 hover:text-red-600 focus:outline-none"
      data-target="leaderboard-page"
    >
      <i class="fas fa-trophy fa-lg"></i>
      <span class="text-xs mt-1">Leaderboard</span>
    </button>
  </nav>
  <script>
    // Show/hide video preview on file select
    const uploadVideoInput = document.getElementById("upload-video-input");
    const uploadVideoPreview = document.getElementById("upload-video-preview");
    uploadVideoInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        uploadVideoPreview.src = url;
        uploadVideoPreview.classList.remove("hidden");
      } else {
        uploadVideoPreview.src = "";
        uploadVideoPreview.classList.add("hidden");
      }
    });

    // Show/hide photo preview on file select
    const uploadPhotoInput = document.getElementById("upload-photo-input");
    const uploadPhotoPreview = document.getElementById("upload-photo-preview");
    uploadPhotoInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        uploadPhotoPreview.src = url;
        uploadPhotoPreview.classList.remove("hidden");
      } else {
        uploadPhotoPreview.src = "";
        uploadPhotoPreview.classList.add("hidden");
      }
    });

    // Comments back button
    const commentsBackBtn = document.getElementById("comments-back-btn");
    commentsBackBtn.addEventListener("click", () => {
      showPage("feed-page");
    });

    // Show register form from login form in profile
    const showRegisterBtn = document.getElementById("show-register-btn");
    const showLoginBtn = document.getElementById("show-login-btn");
    const loginFormEl = document.getElementById("login-form");
    const registerFormEl = document.getElementById("register-form");

    showRegisterBtn.addEventListener("click", () => {
      loginFormEl.classList.add("hidden");
      registerFormEl.classList.remove("hidden");
    });

    showLoginBtn.addEventListener("click", () => {
      registerFormEl.classList.add("hidden");
      loginFormEl.classList.remove("hidden");
    });

    // Logout button in profile content
    const logoutProfileBtn = document.getElementById("logout-profile-btn");
    logoutProfileBtn.addEventListener("click", async () => {
      await signOut(auth);
      updateProfilePageUI();
      showPage("profile-page");
    });
  </script>
</body>
</html>